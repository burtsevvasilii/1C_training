ВЫБРАТЬ
	РеализацияТоваровТовары.Номенклатура КАК Номенклатура,
	СУММА(РеализацияТоваровТовары.Количество) КАК Количество,
	СУММА(РеализацияТоваровТовары.Сумма) КАК Сумма
ПОМЕСТИТЬ Товары
ИЗ
	Документ.РеализацияТоваров.Товары КАК РеализацияТоваровТовары
ГДЕ
	РеализацияТоваровТовары.Ссылка = &Ссылка

СГРУППИРОВАТЬ ПО
	РеализацияТоваровТовары.Номенклатура

ИНДЕКСИРОВАТЬ ПО
	Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Товары.Номенклатура,
	Товары.Количество,
	Товары.Сумма,
	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК Остаток
ИЗ
	Товары КАК Товары
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
				,
				Номенклатура В
					(ВЫБРАТЬ
						Товары.Номенклатура
					ИЗ
						Товары КАК Товары)) КАК ОстаткиТоваровОстатки
		ПО Товары.Номенклатура = ОстаткиТоваровОстатки.Номенклатура


ВЫБРАТЬ
	РеализацияТоваровТовары.Номенклатура,
	МАКСИМУМ(РеализацияТоваровТовары.Ссылка.Дата) КАК Дата
ПОМЕСТИТЬ Даты
ИЗ
	Документ.РеализацияТоваров.Товары КАК РеализацияТоваровТовары

СГРУППИРОВАТЬ ПО
	РеализацияТоваровТовары.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Даты.Номенклатура,
	Даты.Дата,
	МАКСИМУМ(РеализацияТоваров.Ссылка) КАК Ссылка
ИЗ
	Даты КАК Даты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РеализацияТоваров КАК РеализацияТоваров
		ПО Даты.Дата = РеализацияТоваров.Дата

СГРУППИРОВАТЬ ПО
	Даты.Дата,
	Даты.Номенклатура


ВЫБРАТЬ
	МАКСИМУМ(Цены.Период) КАК Период,
	Цены.Номенклатура
ПОМЕСТИТЬ Даты
ИЗ
	РегистрСведений.Цены КАК Цены
ГДЕ
	Цены.Период <= &Период

СГРУППИРОВАТЬ ПО
	Цены.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Даты.Период,
	Даты.Номенклатура,
	Цены.Цена
ИЗ
	Даты КАК Даты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.Цены КАК Цены
		ПО Даты.Период = Цены.Период
			И Даты.Номенклатура = Цены.Номенклатура


ВЫБРАТЬ РАЗЛИЧНЫЕ
	РеализацияТоваровТовары.Номенклатура,
	РеализацияТоваровТовары.Цена,
	РеализацияТоваровТовары.Ссылка.Дата
ПОМЕСТИТЬ Продажи
ИЗ
	Документ.РеализацияТоваров.Товары КАК РеализацияТоваровТовары
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Продажи.Номенклатура,
	Продажи.Цена,
	Продажи.Дата,
	МАКСИМУМ(Цены.Период) КАК Период
ПОМЕСТИТЬ ПродажиИДаты
ИЗ
	Продажи КАК Продажи
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.Цены КАК Цены
		ПО Продажи.Номенклатура = Цены.Номенклатура
			И Продажи.Дата >= Цены.Период

СГРУППИРОВАТЬ ПО
	Продажи.Номенклатура,
	Продажи.Дата,
	Продажи.Цена
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПродажиИДаты.Номенклатура,
	ПродажиИДаты.Цена,
	ПродажиИДаты.Дата,
	ПродажиИДаты.Период,
	Цены.Цена КАК Цена1
ИЗ
	ПродажиИДаты КАК ПродажиИДаты
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Цены КАК Цены
		ПО ПродажиИДаты.Номенклатура = Цены.Номенклатура
			И ПродажиИДаты.Период = Цены.Период





ВЫБРАТЬ
	ВзаиморасчетыОбороты.Период,
	ВзаиморасчетыОбороты.Регистратор,
	ВзаиморасчетыОбороты.Контрагент,
	ВзаиморасчетыОбороты.СуммаРасход
ПОМЕСТИТЬ Оплаты
ИЗ
	РегистрНакопления.Взаиморасчеты.Обороты(, , Регистратор, ) КАК ВзаиморасчетыОбороты

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыОбороты.Период,
	ВзаиморасчетыОбороты.Регистратор,
	ВзаиморасчетыОбороты.Контрагент,
	ВзаиморасчетыОбороты.СуммаРасход
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Оплаты.Регистратор,
	Оплаты.Контрагент КАК Контрагент,
	Оплаты.Период КАК Период,
	Оплаты.СуммаРасход,
	Оплаты1.Период КАК Период1,
	Оплаты1.СуммаРасход КАК СуммаРасход1
ИЗ
	Оплаты КАК Оплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Оплаты КАК Оплаты1
		ПО (Оплаты.Период > Оплаты1.Период
				ИЛИ Оплаты.Период = Оплаты1.Период
					И Оплаты.Регистратор.МоментВремени >= Оплаты1.Регистратор.МоментВремени)
			И Оплаты.Контрагент = Оплаты1.Контрагент

УПОРЯДОЧИТЬ ПО
	Контрагент,
	Период


ВЫБРАТЬ
	ВзаиморасчетыОстаткиИОбороты.Период КАК Период,
	ВзаиморасчетыОстаткиИОбороты.Регистратор,
	ВзаиморасчетыОстаткиИОбороты.Контрагент КАК Контрагент,
	ВзаиморасчетыОстаткиИОбороты.СуммаКонечныйОстаток
ПОМЕСТИТЬ Отгрузки
ИЗ
	РегистрНакопления.Взаиморасчеты.ОстаткиИОбороты(, , Регистратор, , ) КАК ВзаиморасчетыОстаткиИОбороты
ГДЕ
	ВзаиморасчетыОстаткиИОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваров

ИНДЕКСИРОВАТЬ ПО
	Контрагент,
	Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыОбороты.Период КАК Период,
	ВзаиморасчетыОбороты.Регистратор,
	ВзаиморасчетыОбороты.Контрагент КАК Контрагент,
	ВзаиморасчетыОбороты.СуммаРасход
ПОМЕСТИТЬ Оплаты
ИЗ
	РегистрНакопления.Взаиморасчеты.Обороты(
			,
			,
			Регистратор,
			Контрагент В
				(ВЫБРАТЬ
					Отгрузки.Контрагент
				ИЗ
					Отгрузки КАК Отгрузки)) КАК ВзаиморасчетыОбороты

ИНДЕКСИРОВАТЬ ПО
	Контрагент,
	Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Отгрузки.Период КАК Период,
	Отгрузки.Регистратор,
	Отгрузки.Контрагент КАК Контрагент,
	Отгрузки.СуммаКонечныйОстаток,
	Оплаты.Период КАК Период1,
	Оплаты.Регистратор КАК Регистратор1,
	Оплаты.СуммаРасход,
	СУММА(ОплатыНарастающийИтог.СуммаРасход) КАК СуммаРасход1
ПОМЕСТИТЬ ОплатыОтгрузки
ИЗ
	Отгрузки КАК Отгрузки
		ЛЕВОЕ СОЕДИНЕНИЕ Оплаты КАК Оплаты
		ПО Отгрузки.Контрагент = Оплаты.Контрагент
			И (Отгрузки.СуммаКонечныйОстаток > 0)
			И (Отгрузки.Период < Оплаты.Период
				ИЛИ Отгрузки.Период = Оплаты.Период
					И Оплаты.Регистратор.МоментВремени > Отгрузки.Регистратор.МоментВремени)
		ЛЕВОЕ СОЕДИНЕНИЕ Оплаты КАК ОплатыНарастающийИтог
		ПО Отгрузки.Контрагент = ОплатыНарастающийИтог.Контрагент
			И (Отгрузки.СуммаКонечныйОстаток > 0)
			И (Отгрузки.Период < ОплатыНарастающийИтог.Период
				ИЛИ Отгрузки.Период = ОплатыНарастающийИтог.Период
					И ОплатыНарастающийИтог.Регистратор.МоментВремени > Отгрузки.Регистратор.МоментВремени
					И (Оплаты.Период < ОплатыНарастающийИтог.Период
						ИЛИ Оплаты.Период = ОплатыНарастающийИтог.Период
							И ОплатыНарастающийИтог.Регистратор.МоментВремени > Оплаты.Регистратор.МоментВремени))

СГРУППИРОВАТЬ ПО
	Отгрузки.Контрагент,
	Отгрузки.Регистратор,
	Оплаты.Период,
	Оплаты.Регистратор,
	Отгрузки.Период,
	Отгрузки.СуммаКонечныйОстаток,
	Оплаты.СуммаРасход
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыОтгрузки.Период КАК Период,
	ОплатыОтгрузки.Регистратор,
	ОплатыОтгрузки.Контрагент КАК Контрагент,
	ОплатыОтгрузки.СуммаКонечныйОстаток,
	ОплатыОтгрузки.Период1,
	ОплатыОтгрузки.Регистратор1,
	ОплатыОтгрузки.СуммаРасход,
	ОплатыОтгрузки.СуммаРасход1
ИЗ
	ОплатыОтгрузки КАК ОплатыОтгрузки
ГДЕ
	(ОплатыОтгрузки.СуммаКонечныйОстаток <= 0
			ИЛИ ОплатыОтгрузки.СуммаКонечныйОстаток > ОплатыОтгрузки.СуммаРасход1
				И ОплатыОтгрузки.СуммаКонечныйОстаток <= ОплатыОтгрузки.СуммаРасход + ОплатыОтгрузки.СуммаРасход1)

УПОРЯДОЧИТЬ ПО
	Контрагент,
	Период